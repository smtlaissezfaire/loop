#!/usr/bin/env node

var loop = require(__dirname + "/../lib/loop");
var fs = require("fs");

var args = [];

process.argv.forEach(function(val, index) {
  if (index !== 0 && index !== 1) {
    args.push(val);
  }
});

var compile = function(str, options) {
  var out = loop.compile(str, options);
  process.stdout.write(out);
};

var compilationOptions = {
  indent_start : 0,
  indent_level : 2,
  quote_keys   : false,
  space_colon  : true,
  beautify     : true,
  ascii_only   : false,
  inline_script: false
};

if (args.length === 0) {
  var data = "";

  process.stdin.resume();
  process.stdin.setEncoding('utf8');

  process.stdin.on("data", function(chunk) {
    data += chunk;
  });

  process.stdin.on("end", function() {
    compile(data, compilationOptions);
  });
} else {
  args.forEach(function(file) {
    var buffer = fs.readFileSync(file);
    compile(buffer.toString(), compilationOptions);
  });
}
